name: Deploy backend

on:
    push:
        branches:
            - main
        # paths:
        #     - 'back/**'

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2

            - name: Setup Node.js
              uses: actions/setup-node@v2
              with:
                  node-version: '20'

            # - name: Install pnpm
            #   run: npm install -g pnpm

            # - name: Install dependencies
            #   run: cd back && pnpm install

            # - name: Build
            #   run: cd back && node ace build

            # - name: Copy Procfile to build directory
            #   run: cp back/Procfile back/build/Procfile

            # - name: Install production dependencies
            #   run: cd back/build && pnpm install --prod

            - name: Deploy on Heroku
              uses: akhileshns/heroku-deploy@v3.13.15
              with:
                  heroku_api_key: ${{secrets.HEROKU_API_KEY}}
                  heroku_app_name: ${{secrets.HEROKU_BACK_APP_NAME}}
                  heroku_email: ${{secrets.HEROKU_EMAIL}}
                  appdir: 'back'
                  procfile: 'back/Procfile'

    # deploy:
    #     needs: build
    #     runs-on: ubuntu-latest

    #     steps:
    #         - name: Deploy on Heroku
    #           uses: akhileshns/heroku-deploy@v3.13.15
    #           with:
    #               heroku_api_key: ${{secrets.HEROKU_API_KEY}}
    #               heroku_app_name: ${{secrets.HEROKU_BACK_APP_NAME}}
    #               heroku_email: ${{secrets.HEROKU_EMAIL}}
    #               appdir: 'back/build'
    #               procfile: 'back/build/Procfile'
